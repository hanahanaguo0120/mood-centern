<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èº«å¿ƒå®¹ç´ä¹‹çª—ï¼šæƒ…ç·’æ°£è±¡å° (å–®æ©Ÿç‰ˆ)</title>
    
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Activity = (p) => <IconBase {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>;
        const CloudSun = (p) => <IconBase {...p}><path d="M12 2v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="M20 12h2"/><path d="m19.07 4.93-1.41 1.41"/><path d="M15.947 12.65a4 4 0 0 0-5.925-4.128"/><path d="M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z"/></IconBase>;
        const Flame = (p) => <IconBase {...p}><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.148-.224-4.078 1.218-5.19C4.638 6 6 8.129 6 11.852V12a4 4 0 0 0 2.5 2.5Z"/><path d="M10.5 8.112A6.492 6.492 0 0 1 14 6c.966 2.768 0 5.253-2.5 5.5"/><path d="M13.5 16.5A5.5 5.5 0 0 0 19 11v-1c0-1.667-1-3-3-4.5A6.5 6.5 0 0 1 14 14a2.235 2.235 0 0 0 .5 4.5Z"/><path d="M12.5 13.5a2 2 0 0 0 1.996 2.05"/></IconBase>;
        const Snowflake = (p) => <IconBase {...p}><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></IconBase>;
        const Trash2 = (p) => <IconBase {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></IconBase>;
        const Download = (p) => <IconBase {...p}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></IconBase>;
        const Info = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconBase>;

        // --- Chart Component ---
        const MoodChart = ({ history, zones }) => {
            const containerRef = useRef(null);
            const [width, setWidth] = useState(0);
            const height = 200;
            const padding = 30;

            useEffect(() => {
                const updateWidth = () => containerRef.current && setWidth(containerRef.current.getBoundingClientRect().width);
                updateWidth();
                window.addEventListener('resize', updateWidth);
                return () => window.removeEventListener('resize', updateWidth);
            }, []);

            const chartData = [...history].sort((a, b) => a.id - b.id);
            
            const getY = (intensity) => {
                const availableHeight = height - (padding * 2);
                return padding + ((100 - intensity) / 100 * availableHeight);
            };

            const points = chartData.map((entry, index) => {
                const x = chartData.length === 1 ? width / 2 : padding + (index * ((width - padding * 2) / (chartData.length - 1)));
                return { x, y: getY(entry.intensity), entry };
            });

            const pathD = points.map((p, i) => (i === 0 ? 'M' : 'L') + ` ${p.x},${p.y}`).join(' ');

            return (
                <div ref={containerRef} className="bg-white rounded-2xl shadow-sm border border-slate-200 p-4 w-full h-[240px] relative select-none">
                    <svg width="100%" height="100%" className="overflow-visible">
                        {/* Background Zones */}
                        <rect x="0" y="0" width="100%" height="35%" fill="#FEF2F2" opacity="0.5" />
                        <rect x="0" y="35%" width="100%" height="30%" fill="#F0FDF4" opacity="0.5" />
                        <rect x="0" y="65%" width="100%" height="35%" fill="#EFF6FF" opacity="0.5" />
                        
                        <text x="5" y="20" className="text-[10px] fill-red-400 font-bold">éé«˜</text>
                        <text x="5" y="50%" className="text-[10px] fill-green-500 font-bold dominant-baseline-middle">OK</text>
                        <text x="5" y="95%" className="text-[10px] fill-blue-400 font-bold">éä½</text>

                        {/* Line */}
                        {chartData.length > 1 && <path d={pathD} fill="none" stroke="#6366f1" strokeWidth="3" strokeLinecap="round" className="drop-shadow-sm" />}
                        
                        {/* Points */}
                        {points.map((p, i) => (
                            <circle key={i} cx={p.x} cy={p.y} r="6" 
                                fill={p.entry.zone === 'hyper' ? '#f87171' : p.entry.zone === 'ok' ? '#4ade80' : '#60a5fa'} 
                                stroke="white" strokeWidth="2"
                            />
                        ))}
                    </svg>
                    {chartData.length === 0 && (
                        <div className="absolute inset-0 flex items-center justify-center text-slate-400 text-sm">
                            å°šç„¡è³‡æ–™ï¼Œè«‹åœ¨ä¸‹æ–¹æ–°å¢
                        </div>
                    )}
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [selectedZone, setSelectedZone] = useState(null);
            const [intensity, setIntensity] = useState(50);
            const [note, setNote] = useState("");
            const [showInfo, setShowInfo] = useState(false);
            
            // è®€å–/å„²å­˜ LocalStorage
            const [history, setHistory] = useState(() => {
                try { return JSON.parse(localStorage.getItem('moodHistory_v1')) || []; } 
                catch { return []; }
            });

            useEffect(() => {
                localStorage.setItem('moodHistory_v1', JSON.stringify(history));
            }, [history]);

            const zones = [
                { id: 'hyper', name: 'èƒ½é‡éé«˜', desc: 'ç„¦æ…®ã€ç”Ÿæ°£', color: 'bg-red-50 text-red-700 border-red-200', icon: <Flame/>, min: 66, max: 100 },
                { id: 'ok', name: 'å®¹ç´ä¹‹çª—', desc: 'å¹³ç©©ã€å°ˆæ³¨', color: 'bg-green-50 text-green-700 border-green-200', icon: <CloudSun/>, min: 34, max: 65 },
                { id: 'hypo', name: 'èƒ½é‡éä½', desc: 'ç„¡åŠ›ã€æƒ³ç¡', color: 'bg-blue-50 text-blue-700 border-blue-200', icon: <Snowflake/>, min: 0, max: 33 }
            ];

            const addRecord = () => {
                if (!selectedZone) return alert("è«‹å…ˆé¸æ“‡ä¸€å€‹å€åŸŸ");
                const newEntry = {
                    id: Date.now(),
                    date: new Date().toLocaleString('zh-TW', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }),
                    zone: selectedZone.id,
                    intensity: parseInt(intensity),
                    note
                };
                setHistory(prev => [...prev, newEntry]);
                setNote("");
                setIntensity(50);
                setSelectedZone(null);
            };

            const clearHistory = () => {
                if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸå–”ï¼")) setHistory([]);
            };

            // æ–°å¢ï¼šåŒ¯å‡ºåŠŸèƒ½ (è§£æ±ºè€å¸«æƒ³çœ‹è³‡æ–™çš„å•é¡Œ)
            const exportData = () => {
                if (history.length === 0) return alert("ç›®å‰æ²’æœ‰ç´€éŒ„å¯ä»¥åŒ¯å‡ºå–”ï¼");
                
                // è£½ä½œç´”æ–‡å­—å ±è¡¨
                let textContent = "ã€èº«å¿ƒæ°£è±¡å°ï¼šæƒ…ç·’ç´€éŒ„è¡¨ã€‘\n\n";
                history.forEach((h, i) => {
                    textContent += `[${h.date}] å¼·åº¦:${h.intensity} (${h.zone === 'hyper' ? 'éé«˜' : h.zone === 'ok' ? 'OK' : 'éä½'})\n`;
                    if(h.note) textContent += `å‚™è¨»: ${h.note}\n`;
                    textContent += "-------------------\n";
                });

                const blob = new Blob([textContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `æƒ…ç·’ç´€éŒ„_${new Date().toISOString().slice(0,10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };

            const handleZoneClick = (z) => {
                setSelectedZone(z);
                setIntensity(z.id === 'hyper' ? 85 : z.id === 'ok' ? 50 : 15);
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 max-w-2xl mx-auto pb-20">
                    <header className="text-center mb-6">
                        <h1 className="text-2xl font-bold text-slate-800 flex items-center justify-center gap-2">
                            <Activity className="text-indigo-600" /> èº«å¿ƒæ°£è±¡å°
                        </h1>
                        <button onClick={() => setShowInfo(!showInfo)} className="text-xs text-indigo-500 underline mt-2 flex items-center justify-center gap-1 mx-auto">
                            <Info className="w-3 h-3"/> é€™æ˜¯ä»€éº¼ï¼Ÿ
                        </button>
                        {showInfo && (
                            <div className="text-xs text-left bg-white p-3 rounded-lg shadow mt-2 text-slate-600 animate-fadeIn">
                                å°±åƒæ°£è±¡æœ‰æ™´é›¨ï¼Œæˆ‘å€‘çš„å¿ƒä¹Ÿæœ‰èƒ½é‡é«˜ä½ã€‚
                                <br/>ğŸ”´ <strong>éé«˜ï¼š</strong>åƒé¢±é¢¨å¤©ï¼Œåœä¸ä¸‹ä¾†ã€‚
                                <br/>ğŸŸ¢ <strong>OKï¼š</strong>åƒæ™´å¤©ï¼Œèˆ’æœè‡ªåœ¨ã€‚
                                <br/>ğŸ”µ <strong>éä½ï¼š</strong>åƒé™°é›¨å¤©ï¼Œæä¸èµ·å‹ã€‚
                            </div>
                        )}
                    </header>

                    {/* åœ–è¡¨å€ */}
                    <div className="mb-6">
                        <MoodChart history={history} zones={zones} />
                    </div>

                    {/* è¼¸å…¥å€ */}
                    <div className="grid grid-cols-3 gap-2 mb-4">
                        {zones.map(z => (
                            <button key={z.id} onClick={() => handleZoneClick(z)}
                                className={`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-all
                                ${selectedZone?.id === z.id ? `${z.color} border-current ring-2 ring-offset-1 ring-slate-200` : 'bg-white border-slate-100 text-slate-400'}`}>
                                <div className={selectedZone?.id === z.id ? 'scale-110' : 'opacity-50'}>{z.icon}</div>
                                <span className="text-sm font-bold">{z.name}</span>
                            </button>
                        ))}
                    </div>

                    {selectedZone && (
                        <div className="bg-white p-5 rounded-2xl shadow-lg border border-indigo-100 animate-fadeIn mb-8">
                            <label className="block text-sm font-bold text-slate-700 mb-2">èƒ½é‡å¼·åº¦ï¼š{intensity}</label>
                            <input type="range" min={selectedZone.min} max={selectedZone.max} value={intensity} 
                                onChange={(e) => setIntensity(e.target.value)}
                                className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500 mb-4" />
                            
                            <textarea value={note} onChange={(e) => setNote(e.target.value)} placeholder="ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿï¼ˆé¸å¡«ï¼‰"
                                className="w-full p-3 border border-slate-200 rounded-xl mb-4 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" rows="2"></textarea>
                            
                            <button onClick={addRecord} className="w-full py-3 bg-indigo-600 text-white rounded-xl font-bold shadow-md active:scale-95 transition-transform">
                                ç´€éŒ„ä¸‹ä¾†
                            </button>
                        </div>
                    )}

                    {/* æ­·å²ç´€éŒ„å€ */}
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 p-4">
                        <div className="flex justify-between items-center mb-3">
                            <h3 className="font-bold text-slate-700">æ­·å²ç´€éŒ„</h3>
                            <div className="flex gap-2">
                                {history.length > 0 && (
                                    <>
                                    <button onClick={exportData} className="text-xs flex items-center gap-1 px-2 py-1 rounded bg-indigo-50 text-indigo-600 border border-indigo-100">
                                        <Download className="w-3 h-3"/> åŒ¯å‡º
                                    </button>
                                    <button onClick={clearHistory} className="text-xs flex items-center gap-1 px-2 py-1 rounded bg-red-50 text-red-500 border border-red-100">
                                        <Trash2 className="w-3 h-3"/> æ¸…é™¤
                                    </button>
                                    </>
                                )}
                            </div>
                        </div>
                        <div className="space-y-2 max-h-60 overflow-y-auto custom-scrollbar">
                            {history.length === 0 ? <div className="text-center text-slate-400 text-xs py-4">é‚„æ²’æœ‰ç´€éŒ„å–”</div> : 
                                [...history].reverse().map(h => (
                                <div key={h.id} className="flex items-start gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100">
                                    <div className={`w-2 h-2 rounded-full mt-1.5 shrink-0 ${h.zone === 'hyper' ? 'bg-red-400' : h.zone === 'ok' ? 'bg-green-400' : 'bg-blue-400'}`}></div>
                                    <div className="flex-1">
                                        <div className="flex justify-between items-center">
                                            <span className="text-xs font-bold text-slate-700">{h.date}</span>
                                            <span className="text-xs bg-white px-1.5 rounded border border-slate-200 text-slate-500">å¼·åº¦ {h.intensity}</span>
                                        </div>
                                        {h.note && <p className="text-sm text-slate-600 mt-1">{h.note}</p>}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    <footer className="text-center text-slate-400 text-[10px] mt-8">
                        è³‡æ–™åƒ…å„²å­˜æ–¼æœ¬æ©Ÿï¼Œé—œé–‰è¦–çª—æˆ–æ¸…é™¤å¿«å–å¯èƒ½æœƒæ¶ˆå¤±<br/>
                        å»ºè­°å®šæœŸåŒ¯å‡ºå‚™ä»½
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
